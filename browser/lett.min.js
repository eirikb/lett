lett=function(){function d(a){return Object.keys(c).map(function(b){return{index:a.search(c[b]),name:b}}).filter(function(a){return a.index>=0}).sort(function(a,b){return a.index>b.index})[0]}function e(a){var b="",c=[],e=c,f;while(f=d(a)){if(f.index===0){var g=[];g.name=f.name,g.parent=e;if(f.name==="str"){f.index=a.indexOf(a.charAt(f.index),1);if(f.index<0)break;g.push(a.slice(1,f.index)),e.push(g)}else if(f.name==="end")e=e.parent,e.name==="fn"&&(e=e.parent);else if(f.name==="call"||f.name==="chain"){var h=e.length-1;g[f.name]=e[h],e=e[h]=g}else e.push(g),e=g;f.index++}else e.push(a.slice(0,f.index));a=a.slice(f.index).trim()}return e.push(a.trim()),c}function f(a,c){if(a.name){var d=h[a.name](a,c);return d}if(typeof c[a]!="undefined")return c[a];if((""+a).match(/^true$/i))return!0;if((""+a).match(/^false$/i))return!1;if(b[a])return b[a];var e=parseInt(a,10);return isNaN(e)?null:e}function g(a,b){function g(a){a=f(a,b),d.push(a),b[c]=a,c=null}if(a.length===1)return[f(a[0],b)];var c,d=[],e=0;return a.forEach(function(b,d){e%2===0?!b.name&&d<a.length-1?(c=b,e++):g(b):(g(b),e++)}),d}var a={};module={};var b={"+":function(){var a,b=parseInt(arguments[0],10);for(a=1;a<arguments.length;a++)b+=parseInt(arguments[a],10);return b},"-":function(){var a,b=parseInt(arguments[0],10);for(a=1;a<arguments.length;a++)b-=parseInt(arguments[a],10);return b},"/":function(){var a,b=parseInt(arguments[0],10);for(a=1;a<arguments.length;a++)b/=parseInt(arguments[a],10);return b},"*":function(){var a,b=parseInt(arguments[0],10);for(a=1;a<arguments.length;a++)b*=parseInt(arguments[a],10);return b},str:function(){var a,b="";for(a=0;a<arguments.length;a++)b+=arguments[a];return b},gt:function(a,b){return a=parseInt(a,10),b=parseInt(b,10),a>b},lt:function(a,b){return a=parseInt(a,10),b=parseInt(b,10),a<b},eq:function(a,b){return a===b},"if":function(a,b,c){typeof a=="function"&&(a=a());var d=c;return a&&(d=b),typeof d=="function"?d():d},g:function(a,b){return a[b]},"for":function(a,b,c){arguments.length===2&&(c=b,b=a,a=0);var d=[];for(var e=a;e<b;e++)d.push(c(e));return d}};Object.keys(b).forEach(function(c){a[c]=b[c]}),a.if.crap=!0,a.parse=function(a){a=a.replace(/\n|\r/g," ");var b=e(a).filter(function(a){return a});return b};var c={call:/\(/,divide:/ /,fnbody:/,/,fn:/</,obj:/\{/,array:/\[/,chain:/\./,str:/['"]/,end:/[\>\}\]\)]/};module.exports=function(a,b){b||(b={});var c=parser.parse(a),d=g(c,b);return d[d.length-1]};var h={obj:function(a,b){var c={},d=g(a,c);return c},call:function(a,b){var c=b[a.call];c||(c=f(a.call,b));var d=function(d){var e=a.map(function(a){return f(a,b)});return e=e.map(function(a){return d&&d[a]&&(a=d[a]),a}),c.apply(null,e)};return c?(c.crap&&(a.crap=!0),a.parent.crap?d:d()):null},fn:function(a,b){var c=a.slice(0,-1),d=a[a.length-1];return function(){var a=arguments;c.forEach(function(c,d){b[c]=a[d]});var e=f(d,b);return e[e.length-1]}},str:function(a,b){return a[0]},array:function(a,b){return a.map(function(a){return f(a,b)})},chain:function(a,b){var c=f(a.chain,b);return a[0]?f(a[0],c):c},fnbody:function(a,b){return g(a,b)}};return parser=a,builder=a,module.exports}();